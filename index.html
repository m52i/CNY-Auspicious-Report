<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>2026 Auspicious Year Report</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- OG Meta Tags for Social Sharing -->
    <meta property="og:title" content="2026 Auspicious Year Reading">
    <meta property="og:description" content="Free Report Â· No sign-ups Â· No data stored. A light-hearted 2026 Year of the Horse reading prepared by SGHomeCompass.">
    <meta property="og:image" content="https://cny-auspicious-report.vercel.app/MoneyBag.png">
    <meta property="og:image:type" content="image/png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="1200">
    <meta property="og:url" content="https://cny-auspicious-report.vercel.app/">
    <meta property="og:type" content="website">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="2026 Auspicious Year Reading">
    <meta name="twitter:description" content="Free Report Â· No sign-ups Â· No data stored. Prepared by SGHomeCompass.">
    <meta name="twitter:image" content="https://cny-auspicious-report.vercel.app/MoneyBag.png">

    <style>
      :root {
        --bg: #fffaf2;
        --card-bg: #ffffff;
        --accent: #f5a623;
        --accent-dark: #e18f09;
        --text-main: #3e2723;
        --muted: #6d4c41;
        --error: #c62828;
        --border-radius: 18px;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: radial-gradient(circle at top, #ffe9c9 0, #fffaf2 40%);
        color: var(--text-main);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      header {
        text-align: center;
        padding: 32px 16px 8px;
      }

      header h1 {
        margin: 0 0 6px;
        font-size: 2.2rem;
      }

      header p {
        margin: 0;
        color: var(--muted);
        font-size: 0.98rem;
      }

      main {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 16px;
      }

      .card {
        background: var(--card-bg);
        box-shadow: 0 16px 40px rgba(0, 0, 0, 0.06);
        border-radius: var(--border-radius);
        padding: 24px 24px 20px;
        max-width: 720px;
        width: 100%;
        margin-top: 16px;
      }

      .card.center {
        text-align: center;
      }

      .card p {
        margin-top: 0;
        line-height: 1.5;
      }

      .notice {
        font-size: 0.85rem;
        color: var(--muted);
        margin-top: 10px;
      }

      .lang-row {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 16px;
        margin-top: 16px;
      }

      .lang-tile {
        flex: 1 1 220px;
        max-width: 260px;
        background: #ffeede;
        border-radius: 20px;
        border: 1px solid #f1c9a0;
        padding: 16px 14px 18px;
        text-align: center;
        box-shadow: 0 6px 14px rgba(0, 0, 0, 0.06);

        /* keep title + button aligned nicely */
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: space-between;
      }

      .lang-tile-title {
        font-size: 0.95rem;
        font-weight: 600;
        margin-bottom: 10px;

        /* ensure both tiles reserve similar space for text */
        min-height: 2.6em; /* tweak between 2.4â€“2.8em if desired */
      }

      .primary-btn,
      .lang-btn {
        padding: 11px 22px;
        border-radius: 999px;
        border: 1px solid transparent;
        font-size: 0.98rem;
        cursor: pointer;
        transition: background 0.15s ease, color 0.15s ease,
          box-shadow 0.15s ease, border-color 0.15s ease,
          transform 0.05s ease;
      }

      .primary-btn {
        background: var(--accent);
        color: #fff;
        font-weight: 600;
        box-shadow: 0 4px 10px rgba(245, 166, 35, 0.35);
      }

      .primary-btn:hover {
        background: var(--accent-dark);
        transform: translateY(-1px);
      }

      .primary-btn.disabled {
        opacity: 0.6;
        cursor: default;
        box-shadow: none;
        transform: none;
      }

      .lang-btn {
        min-width: 130px;
        background: #ffb686;
        color: #fff;
        border-color: #ff9b5d;
        font-weight: 700;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.25);
      }

      .lang-btn.selected {
        background: var(--accent-dark);
        border-color: var(--accent-dark);
        box-shadow: 0 3px 8px rgba(245, 166, 35, 0.45);
      }

      .dob-row {
        margin-top: 16px;
        text-align: center;
      }

      label {
        display: block;
        font-weight: 600;
        margin-bottom: 4px;
        text-align: center;
      }

      input[type="text"] {
        width: 100%;
        max-width: 360px;
        padding: 10px 14px;
        border-radius: 999px;
        border: 1px solid #e0c3a9;
        font-size: 0.95rem;
        outline: none;
        transition: border-color 0.15s ease, box-shadow 0.15s ease;
        margin: 0 auto;
        text-align: center;
      }

      input[type="text"]:focus {
        border-color: var(--accent);
        box-shadow: 0 0 0 3px rgba(245, 166, 35, 0.2);
      }

      .actions.center {
        display: flex;
        justify-content: center;
        margin-top: 18px;
      }

      .error {
        color: var(--error);
        margin-top: 10px;
        font-size: 0.9rem;
        text-align: center;
      }

      .hidden {
        display: none;
      }

      #result {
        max-width: 720px;
        width: 100%;
        margin-top: 8px;
      }

      #result .report-card {
        background: #fffdf8;
        border-radius: var(--border-radius);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.05);
        padding: 24px;
      }

      #result h2,
      #result h3 {
        margin-top: 0;
        color: #4e342e;
        text-align: center;
      }

      #result ul {
        padding-left: 1.4rem;
      }

      #result li {
        margin-bottom: 4px;
      }

      .signature-card {
        background: #fff3e0;
        border-radius: var(--border-radius);
        max-width: 720px;
        width: 100%;
        padding: 16px 20px;
        margin: 24px auto 24px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 16px;
        box-shadow: 0 10px 28px rgba(0, 0, 0, 0.05);
        font-size: 0.9rem;
        text-align: left;
      }

      .signature-card a {
        color: #1565c0;
        text-decoration: none;
      }

      .signature-card a:hover {
        text-decoration: underline;
      }

      .sig-text {
        flex: 1;
      }

      .sig-logo img {
        max-height: 95px;
        width: auto;
      }

      @media (max-width: 640px) {
        header h1 {
          font-size: 1.7rem;
        }

        .card {
          padding: 20px 18px 18px;
        }

        /* keep logo + text side-by-side on mobile */
        .signature-card {
          flex-direction: row;
          align-items: center;
          text-align: left;
          gap: 12px;
        }

        .sig-logo img {
          max-height: 70px;
        }
      }
    </style>
  </head>

  <body>
    <header>
      <h1 id="mainTitle">2026 Auspicious Year Report</h1>
      <p id="subTitle">One-minute reading. No sign-ups. No data stored.</p>
    </header>

    <main>
      <!-- Intro + language row -->
      <div class="card center" id="languageCard">
        <p id="introEn">
          This light-hearted reading is meant for personal reflection and
          entertainment, not a fixed prediction of your life.
        </p>
        <p class="hidden" id="introZh">
          æœ¬è½»æ¾è¯»ç‰©ä»…ä¾›ä¸ªäººåæ€ä¸å¨±ä¹å‚è€ƒï¼Œå¹¶éå¯¹æ‚¨äººç”Ÿçš„å›ºå®šé¢„è¨€ã€‚
        </p>

        <div class="lang-row">
          <!-- English tile -->
          <div class="lang-tile" id="langTileEn">
            <div class="lang-tile-title" id="langPromptEn">
              Please choose your preferred language.
            </div>
            <button id="langEnBtn" class="lang-btn">English</button>
          </div>

          <!-- Chinese tile -->
          <div class="lang-tile" id="langTileZh">
            <div class="lang-tile-title" id="langPromptZh">
              è¯·é€‰æ‹©æ‚¨åå¥½çš„è¯­è¨€ã€‚
            </div>
            <button id="langZhBtn" class="lang-btn">ä¸­æ–‡</button>
          </div>
        </div>
      </div>

      <!-- Step 2: DoB input + PDPA (appears after language selection) -->
      <div class="card center hidden" id="inputCard">
        <label id="dobLabel" for="dob">
          Enter your Date of Birth
          <span style="font-weight: normal">
            (format <code>DDMMMYYYY</code>, e.g., <code>09AUG1945</code>)
          </span>
        </label>
        <div class="dob-row">
          <input
            id="dob"
            type="text"
            maxlength="9"
            placeholder="09AUG1965"
            autocomplete="off"
          />
        </div>

        <div class="actions center">
          <button id="getReportBtn" class="primary-btn">
            Get My 2026 Year Report
          </button>
        </div>

        <div id="error" class="error"></div>

        <p class="notice" id="noticeEn">
          <strong>Notice &amp; Disclaimer:</strong>
          Your date of birth enables this 2026 Auspicious Year Report and is not
          stored, shared, or used for marketing. Inputs are processed by OpenAI
          in accordance with their
          <a
            href="https://openai.com/policies/privacy-policy"
            target="_blank"
            >Privacy Policy</a
          >. No personal data is collected or retained by
          <strong>Mike Lim</strong>. This reading is meant for reflection and
          entertainment, not medical, financial, or legal advice.
        </p>

        <p class="notice hidden" id="noticeZh">
          <strong>å£°æ˜ä¸å…è´£å£°æ˜ï¼š</strong>
          æ‚¨çš„å‡ºç”Ÿæ—¥æœŸåªç”¨äºç”Ÿæˆæœ¬æ¬¡ <strong>2026 é©¬å¹´è¿åŠ¿æŠ¥å‘Š</strong>ï¼Œä¸ä¼šè¢«å‚¨å­˜ã€åˆ†äº«æˆ–ç”¨äºå¸‚åœºæ¨å¹¿ã€‚
          è¾“å…¥èµ„æ–™ç”± OpenAI ä¾ç…§å…¶
          <a
            href="https://openai.com/policies/privacy-policy"
            target="_blank"
            >éšç§æ”¿ç­–</a
          >
          è¿›è¡Œå¤„ç†ã€‚<strong>æ—ç¥‰å¼º</strong> ä¸ä¼šæ”¶é›†æˆ–ä¿ç•™ä»»ä½•å¯è¯†åˆ«ä¸ªäººèº«ä»½çš„æ•°æ®ã€‚
          æœ¬æŠ¥å‘Šä»…ä¾›å‚è€ƒä¸è‡ªæˆ‘åæ€ï¼Œå¹¶éåŒ»ç–—ã€è´¢åŠ¡æˆ–æ³•å¾‹æ„è§ã€‚
        </p>
      </div>

      <div id="result"></div>

      <div class="signature-card">
        <div class="sig-text" id="sigText"></div>
        <div class="sig-logo">
          <img src="sghc-full.png" alt="SGHomeCompass logo" />
        </div>
      </div>
    </main>

    <script>
      const mainTitle = document.getElementById("mainTitle");
      const subTitle = document.getElementById("subTitle");

      const inputCard = document.getElementById("inputCard");

      const dobInput = document.getElementById("dob");
      const getReportBtn = document.getElementById("getReportBtn");
      const errorEl = document.getElementById("error");
      const resultEl = document.getElementById("result");
      const sigTextEl = document.getElementById("sigText");

      const introEn = document.getElementById("introEn");
      const introZh = document.getElementById("introZh");
      const noticeEn = document.getElementById("noticeEn");
      const noticeZh = document.getElementById("noticeZh");
      const dobLabel = document.getElementById("dobLabel");

      const langEnBtn = document.getElementById("langEnBtn");
      const langZhBtn = document.getElementById("langZhBtn");

      let selectedLanguage = null; // 'en' or 'zh'

      // ---- Limit + UAT configuration ----
      const LIMIT_STORAGE_KEY = "sghc2026_limits";
      const isUAT = window.location.search.includes("uat=1");

      function getTodayKey() {
        const d = new Date();
        return d.toISOString().slice(0, 10); // YYYY-MM-DD
      }

      function loadLimitState() {
        const today = getTodayKey();
        try {
          const raw = localStorage.getItem(LIMIT_STORAGE_KEY);
          if (!raw) {
            return { date: today, enUsed: false, zhUsed: false };
          }
          const parsed = JSON.parse(raw);
          if (!parsed.date || parsed.date !== today) {
            return { date: today, enUsed: false, zhUsed: false };
          }
          return {
            date: parsed.date,
            enUsed: !!parsed.enUsed,
            zhUsed: !!parsed.zhUsed,
          };
        } catch (e) {
          return { date: today, enUsed: false, zhUsed: false };
        }
      }

      let limitState = loadLimitState();

      function saveLimitState() {
        try {
          localStorage.setItem(LIMIT_STORAGE_KEY, JSON.stringify(limitState));
        } catch (e) {
          // ignore storage errors
        }
      }

      function hasReachedLimit(lang) {
        if (isUAT) return false;
        if (lang === "zh") {
          return limitState.zhUsed;
        }
        return limitState.enUsed;
      }

      function markUsed(lang) {
        if (isUAT) return;
        if (lang === "zh") {
          limitState.zhUsed = true;
        } else {
          limitState.enUsed = true;
        }
        saveLimitState();
      }

      // ----- Signature content -----
      const sigHtmlEn = `
        <p>â€” Prepared by <strong>Mike Lim</strong>, CEA Reg No. R026708F</p>
        <p>ğŸ“ +65 9692 9209</p>
        <p><strong>SGHomeCompass</strong> | Your Chapter in Home Transition</p>
        <p>
          ğŸ”—
          <a href="https://www.youtube.com/@SGHomeCompass" target="_blank">YouTube</a> |
          <a href="https://www.instagram.com/sghomecompass/" target="_blank">Instagram</a>
        </p>
      `;

      const sigHtmlZh = `
        <p>â€” ç”± <strong>æ—ç¥‰å¼º</strong> å‡†å¤‡ï¼ŒCEA æ³¨å†Œå·ç  R026708F</p>
        <p>ğŸ“ +65 9692 9209</p>
        <p><strong>SGHomeCompass</strong> ï½œ æ‚¨çš„å±…å®¶è¿‡æ¸¡æ–°ç¯‡ç« </p>
        <p>
          ğŸ”—
          <a href="https://www.youtube.com/@SGHomeCompass" target="_blank">YouTube é¢‘é“</a> |
          <a href="https://www.instagram.com/sghomecompass/" target="_blank">Instagram ä¸“é¡µ</a>
        </p>
      `;

      function setSignatureLanguage(lang) {
        if (!sigTextEl) return;
        sigTextEl.innerHTML = lang === "zh" ? sigHtmlZh : sigHtmlEn;
      }

      function showError(msg) {
        if (!errorEl) return;
        errorEl.textContent = msg || "";
      }

      function setLanguage(lang) {
        selectedLanguage = lang;

        langEnBtn.classList.toggle("selected", lang === "en");
        langZhBtn.classList.toggle("selected", lang === "zh");

        if (lang === "zh") {
          mainTitle.textContent = "2026 é©¬å¹´è¿åŠ¿æŠ¥å‘Š";
          subTitle.textContent = "ä¸€åˆ†é’Ÿè½»æ¾è§£è¯»ã€‚æ— éœ€ç™»å…¥ã€‚ä¸å‚¨å­˜èµ„æ–™ã€‚";

          introEn.classList.add("hidden");
          introZh.classList.remove("hidden");

          noticeEn.classList.add("hidden");
          noticeZh.classList.remove("hidden");

          dobLabel.innerHTML =
            'è¯·è¾“å…¥æ‚¨çš„å‡ºç”Ÿæ—¥æœŸ <span style="font-weight: normal;">ï¼ˆæ ¼å¼ <code>DDMMMYYYY</code>ï¼Œä¾‹å¦‚ <code>09AUG1965</code>ï¼‰</span>';
          getReportBtn.textContent = "ç”Ÿæˆæˆ‘çš„ 2026 é©¬å¹´è¿åŠ¿æŠ¥å‘Š";
        } else {
          mainTitle.textContent = "2026 Auspicious Year Report";
          subTitle.textContent = "One-minute reading. No sign-ups. No data stored.";

          introEn.classList.remove("hidden");
          introZh.classList.add("hidden");

          noticeEn.classList.remove("hidden");
          noticeZh.classList.add("hidden");

          dobLabel.innerHTML =
            'Enter your Date of Birth <span style="font-weight: normal;">(format <code>DDMMMYYYY</code>, e.g., <code>09AUG1965</code>)</span>';
          getReportBtn.textContent = "Get My 2026 Year of the Horse Report";
        }

        setSignatureLanguage(lang);
        inputCard.classList.remove("hidden");
        inputCard.scrollIntoView({ behavior: "smooth", block: "start" });
      }

      function getLimitMessage(lang) {
        if (lang === "zh") {
          return "ä¸ºäº†è®©æ›´å¤šäººå…è´¹ä½¿ç”¨ï¼Œè¿™ä¸ªå·¥å…·æ¯ä½è®¿å®¢æ¯å¤©åªå¯ç”Ÿæˆä¸€ä»½è‹±æ–‡æŠ¥å‘Šå’Œä¸€ä»½ä¸­æ–‡æŠ¥å‘Šã€‚å¦‚æœæ‚¨å·²ç»è·å–äº†è‡ªå·±çš„æŠ¥å‘Šï¼Œæ¬¢è¿æŠŠé“¾æ¥åˆ†äº«ç»™äº²å‹ï¼Œè®©ä»–ä»¬ä¹Ÿè¯•è¯•çœ‹ 2026 é©¬å¹´è¿åŠ¿ ğŸ˜Š";
        }
        return "To keep this free tool open for everyone, each visitor can generate one English and one Chinese report per day. If you've already received yours, please share this link with friends who might enjoy their own 2026 Year of the Horse reading ğŸ˜Š";
      }

      langEnBtn.addEventListener("click", () => setLanguage("en"));
      langZhBtn.addEventListener("click", () => setLanguage("zh"));

      getReportBtn.addEventListener("click", async () => {
        const dob = (dobInput.value || "").trim();

        if (!selectedLanguage) {
          showError("Please choose your preferred language first.");
          return;
        }
        if (!dob) {
          showError("Please enter your date of birth in DDMMMYYYY format.");
          return;
        }

        if (hasReachedLimit(selectedLanguage)) {
          showError(getLimitMessage(selectedLanguage));
          return;
        }

        showError("");
        resultEl.innerHTML = "";
        getReportBtn.disabled = true;
        getReportBtn.classList.add("disabled");

        try {
          const resp = await fetch("/api/fortune", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ dob, language: selectedLanguage }),
          });

          if (!resp.ok) {
            let msg = "Server error. Please try again in a while.";
            try {
              const data = await resp.json();
              if (data && data.error) msg = data.error;
            } catch (_) {}
            throw new Error(msg);
          }

          const data = await resp.json();
          const html = data.html || data.result || "";
          if (!html) {
            throw new Error("The report could not be generated. Please try again.");
          }

          resultEl.innerHTML = `<div class="report-card">${html}</div>`;
          colorizeDosDonts();

          // ğŸ‘‰ NEW: Auto-scroll to the report
          resultEl.scrollIntoView({
          behavior: "smooth",
          block: "start"
          });

          markUsed(selectedLanguage);
        } catch (err) {
          showError(err.message || "Something went wrong. Please try again.");
          resultEl.innerHTML = "";
        } finally {
          getReportBtn.disabled = false;
          getReportBtn.classList.remove("disabled");
        }
      });

      function colorizeDosDonts() {
        if (!resultEl) return;
        const items = resultEl.querySelectorAll("li");
        items.forEach((li) => {
          const text = (li.textContent || "").trim().toLowerCase();
          if (text.startsWith("do:")) {
            li.style.color = "#2e7d32";
          } else if (text.startsWith("don't:") || text.startsWith("dont:")) {
            li.style.color = "#c62828";
          }
        });
      }

      // Default signature: English
      setSignatureLanguage("en");
    </script>
  </body>
</html>
