<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>2026 Auspicious Year Report</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <style>
      :root {
        --bg: #fffaf2;
        --card-bg: #ffffff;
        --accent: #f5a623;
        --accent-dark: #e18f09;
        --text-main: #3e2723;
        --muted: #6d4c41;
        --error: #c62828;
        --border-radius: 16px;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: radial-gradient(circle at top, #ffe9c9 0, #fffaf2 40%);
        color: var(--text-main);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      header {
        text-align: center;
        padding: 32px 16px 16px;
      }

      header h1 {
        margin: 0 0 4px;
        font-size: 2.2rem;
      }

      header p {
        margin: 0;
        color: var(--muted);
      }

      main {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 16px;
      }

      .card {
        background: var(--card-bg);
        box-shadow: 0 16px 40px rgba(0, 0, 0, 0.06);
        border-radius: var(--border-radius);
        padding: 24px 24px 20px;
        max-width: 720px;
        width: 100%;
        margin-bottom: 16px;
      }

      .card p {
        margin-top: 0;
        line-height: 1.5;
      }

      .notice {
        font-size: 0.85rem;
        color: var(--muted);
        margin-top: 8px;
      }

      .actions {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        margin-top: 16px;
      }

      .primary-btn,
      .lang-btn {
        padding: 10px 18px;
        border-radius: 999px;
        border: 1px solid transparent;
        font-size: 0.95rem;
        cursor: pointer;
        transition: background 0.15s ease, color 0.15s ease,
          box-shadow 0.15s ease, border-color 0.15s ease,
          transform 0.05s ease;
      }

      .primary-btn {
        background: var(--accent);
        color: #fff;
        font-weight: 600;
        box-shadow: 0 4px 10px rgba(245, 166, 35, 0.35);
      }

      .primary-btn:hover {
        background: var(--accent-dark);
        transform: translateY(-1px);
      }

      .primary-btn.disabled {
        opacity: 0.6;
        cursor: default;
        box-shadow: none;
        transform: none;
      }

      .lang-btn {
        background: #fff7eb;
        color: var(--text-main);
        border-color: #ffe1b8;
      }

      .lang-btn.selected {
        background: var(--accent);
        color: #fff;
        border-color: var(--accent-dark);
        box-shadow: 0 3px 8px rgba(245, 166, 35, 0.35);
      }

      .dob-row {
        margin-top: 12px;
      }

      label {
        display: block;
        font-weight: 600;
        margin-bottom: 4px;
      }

      input[type="text"] {
        width: 100%;
        padding: 10px 12px;
        border-radius: 999px;
        border: 1px solid #e0c3a9;
        font-size: 0.95rem;
        outline: none;
        transition: border-color 0.15s ease, box-shadow 0.15s ease;
      }

      input[type="text"]:focus {
        border-color: var(--accent);
        box-shadow: 0 0 0 3px rgba(245, 166, 35, 0.2);
      }

      .error {
        color: var(--error);
        margin-top: 8px;
        font-size: 0.9rem;
      }

      .hidden {
        display: none;
      }

      #result {
        max-width: 720px;
        width: 100%;
        margin-top: 8px;
      }

      #result .report-card {
        background: #fffdf8;
        border-radius: var(--border-radius);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.05);
        padding: 24px;
      }

      #result h2,
      #result h3 {
        margin-top: 0;
        color: #4e342e;
      }

      #result ul {
        padding-left: 1.2rem;
      }

      #result li {
        margin-bottom: 4px;
      }

      .signature-card {
        background: #fff3e0;
        border-radius: var(--border-radius);
        max-width: 720px;
        width: 100%;
        padding: 16px 20px;
        margin: 24px auto 24px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 16px;
        box-shadow: 0 10px 28px rgba(0, 0, 0, 0.05);
        font-size: 0.9rem;
      }

      .signature-card a {
        color: #1565c0;
        text-decoration: none;
      }

      .signature-card a:hover {
        text-decoration: underline;
      }

      .sig-logo img {
        max-height: 52px;
        width: auto;
      }

      @media (max-width: 640px) {
        header h1 {
          font-size: 1.7rem;
        }

        .card {
          padding: 20px 16px 18px;
        }

        .signature-card {
          flex-direction: column-reverse;
          align-items: flex-start;
        }

        .sig-logo img {
          max-height: 44px;
        }
      }
    </style>
  </head>

  <body>
    <header>
      <h1>2026 Auspicious Year Report</h1>
      <p>One-minute reading. No sign-ups. No data stored.</p>
    </header>

    <main>
      <!-- Step 1: Language selection + intro -->
      <div class="card" id="languageCard">
        <p>
          Start by choosing your preferred language for this free 2026
          Auspicious Year Report. Itâ€™s a light-hearted reading meant for
          reflection and fun, not a fixed prediction of your life.
        </p>

        <p class="notice" id="introEn">
          This tool only uses your date of birth to generate a short 2026
          reading. It does not store, sell, or share your details. Please pick
          English or Chinese first so that the notice and report appear in your
          chosen language.
        </p>

        <p class="notice hidden" id="introZh">
          è¿™ä¸ªå°å·¥å…·åªä¼šæ ¹æ®æ‚¨çš„å‡ºç”Ÿæ—¥æœŸç”Ÿæˆä¸€ä»½ 2026 å¹´è¿åŠ¿å°è¯»ç‰©ï¼Œä¸ä¼šå‚¨å­˜ã€å‡ºå”®æˆ–åˆ†äº«æ‚¨çš„èµ„æ–™ã€‚
          è¯·å…ˆé€‰æ‹©è‹±æ–‡æˆ–ä¸­æ–‡ï¼Œè®©å£°æ˜å’ŒæŠ¥å‘Šä»¥æ‚¨åå¥½çš„è¯­è¨€å‘ˆç°ã€‚
        </p>

        <div class="actions">
          <button id="langEnBtn" class="lang-btn">English</button>
          <button id="langZhBtn" class="lang-btn">ä¸­æ–‡</button>
        </div>
      </div>

      <!-- Step 2: DoB input + PDPA notice (shown after language is chosen) -->
      <div class="card hidden" id="inputCard">
        <label id="dobLabel" for="dob">
          Enter your Date of Birth
          <span style="font-weight: normal">
            (format <code>DDMMMYYYY</code>, e.g., <code>08DEC1977</code>)
          </span>
        </label>
        <div class="dob-row">
          <input
            id="dob"
            type="text"
            maxlength="9"
            placeholder="08DEC1977"
            autocomplete="off"
          />
        </div>

        <div class="actions">
          <button id="getReportBtn" class="primary-btn">
            Get My 2026 Report
          </button>
        </div>

        <div id="error" class="error"></div>

        <p class="notice" id="noticeEn">
          <strong>Notice &amp; Disclaimer:</strong> Your date of birth enables
          this 2026 Auspicious Year Report and is not stored, shared, or used
          for marketing. Inputs are processed by OpenAI in accordance with their
          <a
            href="https://openai.com/policies/privacy-policy"
            target="_blank"
            >Privacy Policy</a
          >. No personal data is collected or retained by
          <strong>Mike Lim</strong>. This reading is for reflection and
          entertainment, not medical, financial, or legal advice.
        </p>

        <p class="notice hidden" id="noticeZh">
          <strong>å£°æ˜ä¸å…è´£å£°æ˜ï¼š</strong>
          æ‚¨çš„å‡ºç”Ÿæ—¥æœŸåªç”¨äºç”Ÿæˆæœ¬æ¬¡ 2026 è¿åŠ¿æŠ¥å‘Šï¼Œä¸ä¼šè¢«å‚¨å­˜ã€åˆ†äº«æˆ–ç”¨äºå¸‚åœºæ¨å¹¿ã€‚
          è¾“å…¥èµ„æ–™ç”± OpenAI ä¾ç…§å…¶
          <a
            href="https://openai.com/policies/privacy-policy"
            target="_blank"
            >éšç§æ”¿ç­–</a
          >
          è¿›è¡Œå¤„ç†ã€‚<strong>Mike Lim</strong> ä¸ä¼šæ”¶é›†æˆ–ä¿ç•™ä»»ä½•å¯è¯†åˆ«ä¸ªäººèº«ä»½çš„æ•°æ®ã€‚æœ¬æŠ¥å‘Šä»…ä¾›å‚è€ƒä¸è‡ªæˆ‘åæ€ï¼Œå¹¶éåŒ»ç–—ã€è´¢åŠ¡æˆ–æ³•å¾‹æ„è§ã€‚
        </p>
      </div>

      <div id="result"></div>

      <div class="signature-card">
        <div class="sig-text" id="sigText"></div>
        <div class="sig-logo">
          <!-- logo file already in your repo -->
          <img src="sghc-full.png" alt="SGHomeCompass logo" />
        </div>
      </div>
    </main>

    <script>
      const languageCard = document.getElementById("languageCard");
      const inputCard = document.getElementById("inputCard");

      const dobInput = document.getElementById("dob");
      const getReportBtn = document.getElementById("getReportBtn");
      const errorEl = document.getElementById("error");
      const resultEl = document.getElementById("result");
      const sigTextEl = document.getElementById("sigText");

      const introEn = document.getElementById("introEn");
      const introZh = document.getElementById("introZh");
      const noticeEn = document.getElementById("noticeEn");
      const noticeZh = document.getElementById("noticeZh");
      const dobLabel = document.getElementById("dobLabel");

      const langEnBtn = document.getElementById("langEnBtn");
      const langZhBtn = document.getElementById("langZhBtn");

      let selectedLanguage = null; // 'en' or 'zh'

      const EN_LIMIT_KEY = "sghc2026_en_used";
      const ZH_LIMIT_KEY = "sghc2026_zh_used";

      // ----- Signature (advert) content in EN / ZH -----
      const sigHtmlEn = `
        <p>â€” Prepared by <strong>Mike Lim</strong>, CEA Reg No. R026708F</p>
        <p>ğŸ“ +65 9692 9209</p>
        <p><strong>SGHomeCompass</strong> | Your Chapter in Home Transition</p>
        <p>
          ğŸ”—
          <a href="https://www.youtube.com/@SGHomeCompass" target="_blank">YouTube</a> |
          <a href="https://www.instagram.com/sghomecompass/" target="_blank">Instagram</a>
        </p>
      `;

      const sigHtmlZh = `
        <p>â€” ç”± <strong>æ—ç¥‰å¼º</strong> å‡†å¤‡ï¼ŒCEA æ³¨å†Œå·ç  R026708F</p>
        <p>ğŸ“ +65 9692 9209</p>
        <p><strong>SGHomeCompass</strong> ï½œ æ‚¨çš„å±…å®¶è¿‡æ¸¡æ–°ç¯‡ç« </p>
        <p>
          ğŸ”—
          <a href="https://www.youtube.com/@SGHomeCompass" target="_blank">YouTube é¢‘é“</a> |
          <a href="https://www.instagram.com/sghomecompass/" target="_blank">Instagram ä¸“é¡µ</a>
        </p>
      `;

      function setSignatureLanguage(lang) {
        if (!sigTextEl) return;
        sigTextEl.innerHTML = lang === "zh" ? sigHtmlZh : sigHtmlEn;
      }

      // ----- Helpers -----
      function showError(msg) {
        if (!errorEl) return;
        errorEl.textContent = msg || "";
      }

      function setLanguage(lang) {
        selectedLanguage = lang;

        langEnBtn.classList.toggle("selected", lang === "en");
        langZhBtn.classList.toggle("selected", lang === "zh");

        // Switch intro + PDPA text
        if (lang === "zh") {
          introEn.classList.add("hidden");
          introZh.classList.remove("hidden");
          noticeEn.classList.add("hidden");
          noticeZh.classList.remove("hidden");
          dobLabel.innerHTML = `è¯·è¾“å…¥æ‚¨çš„å‡ºç”Ÿæ—¥æœŸ <span style="font-weight: normal;">ï¼ˆæ ¼å¼ <code>DDMMMYYYY</code>ï¼Œä¾‹å¦‚ <code>08DEC1977</code>ï¼‰</span>`;
          getReportBtn.textContent = "ç”Ÿæˆæˆ‘çš„ 2026 è¿åŠ¿æŠ¥å‘Š";
        } else {
          introEn.classList.remove("hidden");
          introZh.classList.add("hidden");
          noticeEn.classList.remove("hidden");
          noticeZh.classList.add("hidden");
          dobLabel.innerHTML = `Enter your Date of Birth <span style="font-weight: normal;">(format <code>DDMMMYYYY</code>, e.g., <code>08DEC1977</code>)</span>`;
          getReportBtn.textContent = "Get My 2026 Report";
        }

        setSignatureLanguage(lang);

        // Reveal the DOB card
        inputCard.classList.remove("hidden");
      }

      function hasReachedLimit(lang) {
        if (lang === "zh") {
          return !!localStorage.getItem(ZH_LIMIT_KEY);
        }
        return !!localStorage.getItem(EN_LIMIT_KEY);
      }

      function markUsed(lang) {
        if (lang === "zh") {
          localStorage.setItem(ZH_LIMIT_KEY, Date.now().toString());
        } else {
          localStorage.setItem(EN_LIMIT_KEY, Date.now().toString());
        }
      }

      function getLimitMessage(lang) {
        if (lang === "zh") {
          return "ä¸ºäº†è®©æ›´å¤šäººå…è´¹ä½¿ç”¨ï¼Œè¿™ä¸ªå·¥å…·æ¯ä½è®¿å®¢åªå¯ç”Ÿæˆä¸€ä»½è‹±æ–‡æŠ¥å‘Šå’Œä¸€ä»½ä¸­æ–‡æŠ¥å‘Šã€‚å¦‚æœæ‚¨å·²ç»è·å–äº†è‡ªå·±çš„æŠ¥å‘Šï¼Œæ¬¢è¿æŠŠé“¾æ¥åˆ†äº«ç»™äº²å‹ï¼Œè®©ä»–ä»¬ä¹Ÿè¯•è¯•çœ‹ 2026 è¿åŠ¿ ğŸ˜Š";
        }
        return "To keep this free tool open for everyone, each visitor can generate one English and one Chinese report. If youâ€™ve already gotten yours, please share this link with friends who might enjoy their own 2026 reading ğŸ˜Š";
      }

      // ----- Event wiring -----
      langEnBtn.addEventListener("click", () => setLanguage("en"));
      langZhBtn.addEventListener("click", () => setLanguage("zh"));

      getReportBtn.addEventListener("click", async () => {
        const dob = (dobInput.value || "").trim();

        if (!selectedLanguage) {
          showError("Please choose your preferred language first.");
          return;
        }
        if (!dob) {
          showError("Please enter your date of birth in DDMMMYYYY format.");
          return;
        }

        if (hasReachedLimit(selectedLanguage)) {
          showError(getLimitMessage(selectedLanguage));
          return;
        }

        showError("");
        resultEl.innerHTML = "";
        getReportBtn.disabled = true;
        getReportBtn.classList.add("disabled");

        try {
          const resp = await fetch("/api/fortune", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ dob, language: selectedLanguage }),
          });

          if (!resp.ok) {
            let msg = "Server error. Please try again in a while.";
            try {
              const data = await resp.json();
              if (data && data.error) msg = data.error;
            } catch (_) {
              // ignore JSON parse error
            }
            throw new Error(msg);
          }

          const data = await resp.json();
          const html = data.html || data.result || "";
          if (!html) {
            throw new Error(
              "The report could not be generated. Please try again."
            );
          }

          resultEl.innerHTML = `<div class="report-card">${html}</div>`;
          colorizeDosDonts();
          markUsed(selectedLanguage);
        } catch (err) {
          showError(err.message || "Something went wrong. Please try again.");
          resultEl.innerHTML = "";
        } finally {
          getReportBtn.disabled = false;
          getReportBtn.classList.remove("disabled");
        }
      });

      // Colour Do / Don't bullets
      function colorizeDosDonts() {
        if (!resultEl) return;
        const items = resultEl.querySelectorAll("li");
        items.forEach((li) => {
          const text = (li.textContent || "").trim().toLowerCase();
          if (text.startsWith("do:")) {
            li.style.color = "#2e7d32";
          } else if (text.startsWith("don't:") || text.startsWith("dont:")) {
            li.style.color = "#c62828";
          }
        });
      }

      // Initialise footer as English on first load
      setSignatureLanguage("en");
    </script>
  </body>
</html>
